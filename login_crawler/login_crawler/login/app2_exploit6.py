#Importing Required Packages

import urllib2
import json
import time
import requests
import copy
import os
from selenium.webdriver.common.by import By
from bs4 import BeautifulSoup
from pprint import pprint
from selenium import webdriver
from selenium.webdriver.support.ui import Select
from urlparse import urlparse,parse_qs
from selenium.common.exceptions import NoSuchElementException


mydriver = webdriver.Firefox()
mydriver.get("https://app2.com/login/index.php")
mydriver.find_element_by_id('username').send_keys('admin')
mydriver.find_element_by_id('password').send_keys('AdminAdmin1!')
mydriver.find_element_by_id('loginbtn').click()
#Application SessionKey fetch
appsesskeyPayload = {u'sesskey': 'randomvalue'}

appsesskeyPayload['url'] = mydriver.current_url
session_keyword = 'sesskey'
sessK = ''
mydriver.get(appsesskeyPayload.get('url'))
pgsrc = mydriver.page_source
soup = BeautifulSoup(pgsrc)
allA = soup.find_all('a')
for indA in allA:
	if indA.get('href') is not None:
		if session_keyword in indA.get('href'):
			u = indA.get('href')
			o = urlparse(u)
			paramdict = parse_qs(o.query)
			sessK = paramdict[session_keyword][0]
			break
for skeyword in appsesskeyPayload:
	if skeyword != 'url':
		session_keyvalue = sessK


tempurl = "https://app2.com/course/switchrole.php?returnurl=https://www.google.com&id=3&switchrole=6"
finalurl = tempurl + "&" + session_keyword + "=" + session_keyvalue
print "finalurl is " + finalurl
mydriver.get(finalurl)
mydriver.quit()


##END OF FILE##
