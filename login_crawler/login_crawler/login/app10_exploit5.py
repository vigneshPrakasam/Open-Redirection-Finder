#Importing Required Packages

import urllib2
import json
import time
import requests
import copy
import os
from selenium.webdriver.common.by import By
from bs4 import BeautifulSoup
from pprint import pprint
from selenium import webdriver
from selenium.webdriver.support.ui import Select
from urlparse import urlparse,parse_qs
from selenium.common.exceptions import NoSuchElementException


with open("input.json")as fs:
	inputjson = json.load(fs)
dynamic_param = inputjson.get("dynamic_param")
label = inputjson.get("label")
sessK = ""
origin = inputjson.get("origin") #please provide the "/" (forward slash) at the end
login_page = inputjson.get("login_page")
#form parameters
form_username_name = inputjson.get("form_username_name")
form_username_value = inputjson.get("form_username_value")
form_password_name = inputjson.get("form_password_name")
form_password_value = inputjson.get("form_password_value")
login = inputjson.get("login") #False - if login not needed (for app10.com - login not required)
with requests.Session() as s:
	print login
	if login is True:
		print "here"
		formPayload = {form_username_name: form_username_value, form_password_name: form_password_value}
		p = s.post(login_page, data=formPayload, verify=False)
		if dynamic_param is True:
			soup = BeautifulSoup(p.text)
			allA = soup.find_all('a')
			for indA in allA:
				if indA.get('href') is not None:
					if label in indA.get('href'):
						u = indA.get('href')
						o = urlparse(u)
						paramdict = parse_qs(o.query)
						sessK = paramdict[label][0]
						break
	payload = {"name": "","friend_name": "","cmd": "send","contact_us": "0","friend_email": "","visual": "","Referer": "https://www.google.com","item_id": "0","AXSRF_token": "","type": "post","email": ""}
	s.headers.update({"Referer":"https://www.google.com"})
	r = s.post('http://app10.com/tell.php', data=payload, verify=False, allow_redirects=True)
	print r.text
	print r.url
	mydriver = webdriver.Firefox()
	mydriver.get(r.url)
	mydriver.quit()


##END OF FILE##
