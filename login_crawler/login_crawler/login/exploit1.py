#Importing Required Packages

import urllib2
import json
import time
import requests
import copy
import os
from selenium.webdriver.common.by import By
from bs4 import BeautifulSoup
from pprint import pprint
from selenium import webdriver
from selenium.webdriver.support.ui import Select
from selenium.common.exceptions import NoSuchElementException


mydriver = webdriver.Firefox()
mydriver.get("https://app2.com/login/index.php")
mydriver.find_element_by_id('username').send_keys('admin')
mydriver.find_element_by_id('password').send_keys('AdminAdmin1!')
#Application SessionKey fetch
appsesskeyPayload = {u'sesskey': 'randomvalue'}

appsesskeyPayload['url'] = mydriver.current_url
mydriver.get(appsesskeyPayload.get('url'))
pgsrc = mydriver.page_source
soup = BeautifulSoup(pgsrc)
allA = soup.find_all('a')
for indA in allA:
	if indA.get('href') is not None:
		valA = indA.get('href').split('?')
		if valA[0] in appsesskeyPayload.get('url'):
			sessKsplit = valA[1].split('=')
			sessK = sessKsplit[1]
			break
for skeyword in appsesskeyPayload:
	if skeyword != 'url':
		session_keyword = skeyword
		session_keyvalue = sessK


pageurl = "https://app2.com/user/files.php"
mydriver.get(pageurl)
elements = mydriver.find_elements_by_tag_name('input')
payload = {u'returnurl': u'https://www.google.com', u'files_filemanager': u'797249431', u'sesskey': u'Nj6p72PqGR', u'_qf__user_files_form': u'1', u'null': u''}

payload[session_keyword] = session_keyvalue

flag_successful = False
first_flag = True
for keyword in payload:
	if payload.get(keyword):
		for element in elements:
			if element.get_attribute('name') == keyword:
				flag_successful = True
				script = "return arguments[0].value = '" + payload.get(keyword) + "'"
				mydriver.execute_script(script, element)

if flag_successful:
	flag_successful = False
else:
	for keyword in payload :
		if first_flag :
			if payload.get(keyword) :
				finalurl = pageurl + "?" + keyword + "=" + payload.get(keyword)
				first_flag = False
		else:
			if payload.get(keyword):
				finalurl = finalurl + "&" + keyword + "=" + payload.get(keyword)
if first_flag is False:
	mydriver.get(finalurl)
elementbtn = mydriver.find_element_by_xpath("//input[starts-with(@type,'submit')]")
elementbtn.submit()


mydriver.quit()


##END OF FILE##
